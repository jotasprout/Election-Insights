<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1' />
        <meta name='apple-mobile-web-app-capable' content='yes'>
        <meta name='mobile-web-app-capable' content='yes'> 

        <script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
        <script src='https://d3js.org/d3.v4.min.js'></script>

        <script src='states.js'></script>
        <link rel='stylesheet' type='text/css' href='prezStyle.css'>

        <link rel='stylesheet' type='text/css' href='https://www.roxorsoxor.com/bootstrap4/css/bootswatch-slate.min.css'>
        <link rel='stylesheet' type='text/css' href='https://www.roxorsoxor.com/bootstrap4/js/bootstrap.min.js'>

    </head>
<body>
<script>

    // Width and Height
    const w = 1000;
    const h = 650;

    // Map projection
    const projection = d3.geoAlbersUsa()
                            .translate([w/2, h/2])
                            .scale([1000]);

    // Path Generator
    const path = d3.geoPath()
                    .projection(projection);

    // Create SVG
    const svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

    let winners = [];

    // console.log(states);

    fetch(`getSocialistResults.php`).then(function(response){
        return response.json();
    }).then(function(response){
        // console.log(response);
        states.forEach(function (state){
            let stateCandidates = response.filter(function (candidateResult){
                return candidateResult.stateAbbr === state;
            })

            let stateWinner = stateCandidates.reduce((max, candidate) => max && max.popVotes > candidate.popVotes ? max : candidate, null);

            if (stateWinner.popVotes == 0) {
                console.log (stateWinner.stateName + " has no votes or candidates");

                stateWinner = {
                    'stateName': stateWinner.stateName,
                    'popVotes': 0,
                    'candidateName': 'None',
                    'candidateID': 0,
                    'stateAbbr': stateWinner.stateAbbr
                };
            };
            
            console.log (stateWinner);
            winners.push(stateWinner);
        });

        // console.log(winners);

        function getGeoJSON () {
        } // end of getGeoJSON

        // Get geoJSON
        d3.json("myPrezData/us-states.json", function(json) {


            function combineMapWinners (json) {
                //Merge the ag. data and GeoJSON
                //Loop through once for each ag. data value
                for (var i = 0; i < winners.length; i++) {
                    // Get the state name
                    let dataState = winners[i].stateName;
                    // console.log("first winners state is " + dataState);
                    // Get winning candidate
                    let dataWinner = winners[i].candidateID;
                    // console.log(dataWinner + " won " + dataState);
                    //Find the corresponding state inside the GeoJSON
                    for (var j = 0; j < json.features.length; j++) {
                        let jsonState = json.features[j].properties.name;
                        if (dataState == jsonState) {
                        // console.log(dataState + " equals " + jsonState);
                            json.features[j].properties.winner = dataWinner;
                        }
                        else {
                        // console.log(dataState + " does not equal " + jsonState);
                        }
                    }
                }
            } // end of combineMapWinners

            combineMapWinners(json);

            //Merge the ag. data and GeoJSON
            //Loop through once for each ag. data value
            /*
            for (var i = 0; i < winners.length; i++) {
                // Get the state name
                let dataState = winners[i].stateName;
                // console.log("first winners state is " + dataState);
                // Get winning candidate
                let dataWinner = winners[i].candidateID;
                // console.log(dataWinner + " won " + dataState);
                //Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    let jsonState = json.features[j].properties.name;
                    if (dataState == jsonState) {
                    // console.log(dataState + " equals " + jsonState);
                        json.features[j].properties.winner = dataWinner;
                    }
                    else {
                    // console.log(dataState + " does not equal " + jsonState);
                    }
                }
            }
            */
            // console.log(json);    

            function bindData () {
                //Bind data and create one path per GeoJSON feature
                svg.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("stroke", "#e0e0e0")
                    .attr("class", function(d) {
                        let value = d.properties.winner;
                        switch (value) {
                            case '1':
                                return "frank-atwood"; // frank-atwood
                                break;
                            case '2':
                                return "darrell-castle"; // darrell-castle
                                break;
                            case '3':
                                return "hillary-clinton"; // hillary-clinton
                                break;
                            case '4':
                                return "scott-copeland"; // scott-copeland
                                break;   
                            case '5':
                                return "roque-delafuente"; // roque-delafuente
                                break;   
                            case '6':
                                return "richard-duncan"; // richard-duncan
                                break; 
                            case '7':
                                return "rocky-giordani"; // rocky-giordani
                                break;      
                            case '8':
                                return "james-hedges"; // james-hedges
                                break;
                            case '9':
                                return "tom-hoefling"; // tom-hoefling
                                break; 
                            case '10':
                                return "princess-jacob"; // princess-jacob
                                break;  
                            case '11':
                                return "gary-johnson"; // gary-johnson
                                break;                                
                            case '12':
                                return "lynn-kahn"; // Lynn S. Kahn
                                break;
                            case '13':
                                return "chris-keniston"; // Chris Keniston
                                break;
                            case '14':
                                return "alyson-kennedy"; // Alyson Kennedy
                                break;
                            case '15':
                                return "kyle-kopitke"; // kyle-kopitke
                                break;   
                            case '16':
                                return "laurence-kotlikoff"; // laurence-kotlikoff
                                break;   
                            case '17':
                                return "gloria-estelalariva"; // Gloria Estela La Riva
                                break;   
                            case '18':
                                return "bradford-lyttle"; // Bradford Lyttle
                                break; 
                            case '19':
                                return "joseph-maldonado"; // joseph-maldonado
                                break;   
                            case '20':
                                return "michael-maturen"; // Michael A. Maturen
                                break;   
                            case '21':
                                return "evan-mcmullin"; // evan-mcmullin
                                break;
                            case '22':
                                return "monica-moorehead"; // Monica Moorehead
                                break;
                            case '23':
                                return "ryan-scott"; // ryan-scott
                                break;       
                            case '24':
                                return "rod-silva"; // rod-silva
                                break;
                            case '25':
                                return "peter-skewes"; // peter-skewes
                                break;  
                            case '26':
                                return "mike-smith"; // mike-smith
                                break;
                            case '27':
                                return "emidio-soltysik"; // Emidio Soltysik
                                break;       
                            case '28':
                                return "jill-stein"; // Jill Stein
                                break;
                            case '29':
                                return "donald-trump"; // Donald Trump
                                break;
                            case '30':
                                return "dan-r-vacek"; // Dan R. Vacek
                                break;  
                            case '31':
                                return "jerry-white"; // Jerry White 
                                break;
                            
                            default:
                                return "nope";
                                break;  
                        }
                    }); 
            } // end of bindData    

            bindData();       
/*
            //Bind data and create one path per GeoJSON feature
            svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke", "#e0e0e0")
                .attr("class", function(d) {
                    let value = d.properties.winner;
                    switch (value) {
                        case '1':
                            return "frank-atwood"; // frank-atwood
                            break;
                        case '2':
                            return "darrell-castle"; // darrell-castle
                            break;
                        case '3':
                            return "hillary-clinton"; // hillary-clinton
                            break;
                        case '4':
                            return "scott-copeland"; // scott-copeland
                            break;   
                        case '5':
                            return "roque-delafuente"; // roque-delafuente
                            break;   
                        case '6':
                            return "richard-duncan"; // richard-duncan
                            break; 
                        case '7':
                            return "rocky-giordani"; // rocky-giordani
                            break;      
                        case '8':
                            return "james-hedges"; // james-hedges
                            break;
                        case '9':
                            return "tom-hoefling"; // tom-hoefling
                            break; 
                        case '10':
                            return "princess-jacob"; // princess-jacob
                            break;  
                        case '11':
                            return "gary-johnson"; // gary-johnson
                            break;                                
                        case '12':
                            return "lynn-kahn"; // Lynn S. Kahn
                            break;
                        case '13':
                            return "chris-keniston"; // Chris Keniston
                            break;
                        case '14':
                            return "alyson-kennedy"; // Alyson Kennedy
                            break;
                        case '15':
                            return "kyle-kopitke"; // kyle-kopitke
                            break;   
                        case '16':
                            return "laurence-kotlikoff"; // laurence-kotlikoff
                            break;   
                        case '17':
                            return "gloria-estelalariva"; // Gloria Estela La Riva
                            break;   
                        case '18':
                            return "bradford-lyttle"; // Bradford Lyttle
                            break; 
                        case '19':
                            return "joseph-maldonado"; // joseph-maldonado
                            break;   
                        case '20':
                            return "michael-maturen"; // Michael A. Maturen
                            break;   
                        case '21':
                            return "evan-mcmullin"; // evan-mcmullin
                            break;
                        case '22':
                            return "monica-moorehead"; // Monica Moorehead
                            break;
                        case '23':
                            return "ryan-scott"; // ryan-scott
                            break;       
                        case '24':
                            return "rod-silva"; // rod-silva
                            break;
                        case '25':
                            return "peter-skewes"; // peter-skewes
                            break;  
                        case '26':
                            return "mike-smith"; // mike-smith
                            break;
                        case '27':
                            return "emidio-soltysik"; // Emidio Soltysik
                            break;       
                        case '28':
                            return "jill-stein"; // Jill Stein
                            break;
                        case '29':
                            return "donald-trump"; // Donald Trump
                            break;
                        case '30':
                            return "dan-r-vacek"; // Dan R. Vacek
                            break;  
                        case '31':
                            return "jerry-white"; // Jerry White 
                            break;
                        
                        default:
                            return "nope";
                            break;  
                    }
                }); // end of binding data
                */
        }); // end of getGeoJSON
            
    });

</script>

<div class="container">

<form id="selectCandidates" action="" method="post">

    <fieldset class="form-group">
        <legend>Opponents</legend>

        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="socialists-all" value="socialists-all" checked="">
                All Socialists
            </label>
        </div>
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="socialists-nogreen" value="socialists-nogreen">
                All Socialists Except Jill Stein (Green)
            </label>
        </div>            
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="left-all-vs-trump" value="left-all-vs-trump">
                All "Left" vs Trump (Republican)
            </label>
        </div>
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="right-all-notrump" value="right-all-notrump">
                All "Right"
            </label>
        </div>
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="right-all-vs-clinton" value="right-all-vs-clinton">
                All "Right" vs Clinton (Democratic)
            </label>
        </div>
        <div class="form-check">
            <label class="form-check-label">
                <input type="radio" class="form-check-input" name="opponents" id="right-all-vs-left-all" value="right-all-vs-left-all"> 
                Left vs Right
            </label>
        </div>   

    </fieldset>

</form>

<div id="legend">

    <div class="candi-legend" id="jill-stein">
        <div class="candi-box jill-stein"></div>
        <div class="candi-name">Jill Stein</div>
    </div>

    <div class="candi-legend" id="alyson-kennedy">
        <div class="candi-box alyson-kennedy"></div>
        <div class="candi-name">Alyson Kennedy</div>
    </div>

    <div class="candi-legend" id="chris-keniston">
        <div class="candi-box chris-keniston"></div>
        <div class="candi-name">Chris Keniston</div>
    </div>

    <div class="candi-legend" id="roque-delafuente">
        <div class="candi-box roque-delafuente"></div>
        <div class="candi-name">Roque De La Fuente</div>
    </div>   

</div>

</div> <!-- End of Container -->

</body>
</html>