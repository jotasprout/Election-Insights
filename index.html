<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1' />
        <meta name='apple-mobile-web-app-capable' content='yes'>
        <meta name='mobile-web-app-capable' content='yes'> 

        <script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
        <script src='https://d3js.org/d3.v4.min.js'></script>
        <!--             
            link to CSS
        -->
    </head>
    <body>
        <script>

            // Width and Height
            const w = 1000;
            const h = 750;

            // Map projection
            const projection = d3.geoAlbersUsa()
                                 .translate([w/2, h/2])
                                 .scale([1000]);

            // Path Generator
            const path = d3.geoPath()
                           .projection(projection);

            // Create SVG
            const svg = d3.select("body")
                          .append("svg")
                          .attr("width", w)
                          .attr("height", h);

            // get election results
            d3.json("getSocialistWinners.php", function(data) {

                // so I can see what it looks like
                console.log(data);

                // Get geoJSON
                d3.json("myPrezData/us-states.json", function(json) {

                    //Merge the ag. data and GeoJSON
					//Loop through once for each ag. data value
                    for (var i = 0; i < data.length; i++) {

                        // Get the state name
                        let dataState = data[i].stateName;
                        // console.log(dataState);

                        // Get winning candidate
                        let dataWinner = data[i].candidateID;
                        // console.log(dataWinner + " won " + dataState);

                        //Find the corresponding state inside the GeoJSON
                        for (var j = 0; j < json.features.length; j++) {

                            let jsonState = json.features[j].properties.name;

                            if (dataState == jsonState) {
                               // console.log("Yay!" + [j]);
                               json.features[j].properties.winner = dataWinner
                            }
                        }
                    }
                    //Bind data and create one path per GeoJSON feature
                    svg.selectAll("path")
                        .data(json.features)
                        .enter()
                        .append("path")
                        .attr("d", path)
                        .style("stroke", "#e0e0e0")
                        .style("fill", function(d) {
                            let value = d.properties.winner;
                            switch (value) {
                                case '28':
                                    return "#f00"; // Jill Stein
                                    break;
                                case '17':
                                    return "#00f"; // Gloria Elela La Riva
                                    break;   
                                case '12':
                                    return "#ff0"; // Lynn S. Kahn
                                    break;
                                case '13':
                                    return "#060"; // Chris Keniston
                                    break;
                                case '14':
                                    return "#0f0"; // Alyson Kennedy
                                    break;   
                                case '20':
                                    return "#f09"; // Michael A. Maturen
                                    break;   
                                case '22':
                                    return "#606"; // Monica Moorehead
                                    break;
                                case '27':
                                    return "#09f"; // Emidio Soltysik
                                    break;       
                                default:
                                    return "#ccc";
                                    break;  
                                /* 
                                case '30':
                                    return "#7d7d7d"; // Dan R. Vacek -- not in winner results now
                                    break;  
                                case '31':
                                    return "#000"; // Jerry White -- not in winner results now
                                    break;
                                case '18':
                                    return "#f60"; // Bradford Lyttle -- not in winner results now
                                    break;   
                                */                           
                            }
                        });
                });    
            });
        </script>
    </body>
</html>